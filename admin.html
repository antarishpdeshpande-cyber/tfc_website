<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFC Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: Inter, sans-serif;
            background: #0f0f0f;
            color: #f5f5f5;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-family: "Bebas Neue";
            color: #f7c600;
            letter-spacing: 1px;
        }

        label {
            display: block;
            margin-top: 15px;
            font-size: 13px;
            color: #aaa;
            margin-bottom: 5px;
        }

        input,
        textarea {
            width: 100%;
            padding: 10px;
            background: #222;
            border: 1px solid #333;
            color: white;
            border-radius: 8px;
            font-family: inherit;
        }

        button {
            margin-top: 20px;
            width: 100%;
            padding: 14px;
            background: #f7c600;
            border: none;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            color: black;
            font-size: 16px;
        }

        button:hover {
            background: #ffdd57;
        }

        .section {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid #333;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #33d17a;
            color: black;
            padding: 10px 20px;
            border-radius: 8px;
            display: none;
        }

        .login-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .err {
            color: #ff5a5a;
            font-size: 13px;
            margin-top: 5px;
        }
    </style>
</head>

<body>

    <!-- Login Overlay -->
    <div id="loginScreen" class="login-overlay">
        <h1>TFC Admin Login</h1>
        <div style="width:100%; max-width:300px;">
            <label>Email</label>
            <input id="email" type="email" placeholder="admin@tfc.in">
            <label>Password</label>
            <input id="pass" type="password" placeholder="Password">
            <button id="loginBtn">Login</button>
            <div id="loginMsg" class="err"></div>
        </div>
    </div>

    <h1>TFC Content Manager</h1>

    <div class="section">
        <h3>Global Settings</h3>
        <label>WhatsApp Number (Country Code + Number)</label>
        <input id="waNumber" placeholder="918950723024">
    </div>

    <div class="section">
        <h3>Coaches (Fight Cards)</h3>
        <label>Coach A Name</label>
        <input id="cA_name" placeholder="Coach A">
        <label>Coach A Title</label>
        <input id="cA_rank" placeholder="Striking">

        <hr style="border-color:#333; margin:15px 0;">

        <label>Coach B Name</label>
        <input id="cB_name" placeholder="Coach B">
        <label>Coach B Title</label>
        <input id="cB_rank" placeholder="Grappling">

        <hr style="border-color:#333; margin:15px 0;">

        <label>Coach C Name</label>
        <input id="cC_name" placeholder="Coach C">
        <label>Coach C Title</label>
        <input id="cC_rank" placeholder="S&C">
    </div>

    <div class="section">
        <h3>Gallery (Video Links)</h3>
        <label>Video 1 URL (mp4)</label>
        <input id="vid1">
        <label>Video 2 URL (mp4)</label>
        <input id="vid2">
        <label>Video 3 URL (mp4)</label>
        <input id="vid3">
        <label>Video 4 URL (mp4)</label>
        <input id="vid4">
    </div>

    <button id="saveBtn">Save Changes</button>
    <div class="toast" id="toast">Saved Successfully!</div>

    <script>
        const $ = id => document.getElementById(id);
        let savedPass = "";

        // Login Logic
        $("loginBtn").addEventListener("click", () => {
            const e = $("email").value;
            const p = $("pass").value;
            if (e === "admin@tfc.in" && p === "tfc123") {
                $("loginScreen").style.display = "none";
                savedPass = p;
                loadData();
            } else {
                $("loginMsg").textContent = "Invalid Credentials";
            }
        });

        // Load Data from Backend
        async function loadData() {
            try {
                const res = await fetch('/.netlify/functions/get_content');
                const data = await res.json();
                if (!data) return;

                if (data.wa) $("waNumber").value = data.wa;
                if (data.cA) $("cA_name").value = data.cA.name;
                if (data.cA) $("cA_rank").value = data.cA.rank;
                if (data.cB) $("cB_name").value = data.cB.name;
                if (data.cB) $("cB_rank").value = data.cB.rank;
                if (data.cC) $("cC_name").value = data.cC.name;
                if (data.cC) $("cC_rank").value = data.cC.rank;

                if (data.v1) $("vid1").value = data.v1;
                if (data.v2) $("vid2").value = data.v2;
                if (data.v3) $("vid3").value = data.v3;
                if (data.v4) $("vid4").value = data.v4;

            } catch (e) {
                console.error("Load failed", e);
                // Fallback/First time clean state
            }
        }

        // Save Data to Backend
        $("saveBtn").addEventListener("click", async () => {
            const payload = {
                wa: $("waNumber").value,
                cA: { name: $("cA_name").value, rank: $("cA_rank").value },
                cB: { name: $("cB_name").value, rank: $("cB_rank").value },
                cC: { name: $("cC_name").value, rank: $("cC_rank").value },
                v1: $("vid1").value,
                v2: $("vid2").value,
                v3: $("vid3").value,
                v4: $("vid4").value
            };

            $("saveBtn").textContent = "Saving...";

            try {
                const res = await fetch('/.netlify/functions/update_content', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        password: savedPass,
                        data: payload
                    })
                });

                if (res.ok) {
                    $("toast").style.display = "block";
                    setTimeout(() => $("toast").style.display = "none", 3000);
                } else {
                    alert("Failed to save.");
                }
            } catch (e) {
                alert("Error saving: " + e.message);
            }
            $("saveBtn").textContent = "Save Changes";
        });
    </script>
</body>

</html>